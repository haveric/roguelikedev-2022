"use strict";(self.webpackChunkroguelikedev_2022=self.webpackChunkroguelikedev_2022||[]).push([[143],{890:(e,t,s)=>{s.d(t,{Z:()=>a});var o=s(537),n=s.n(o),r=s(645),i=s.n(r)()(n());i.push([e.id,"* {\n    box-sizing: border-box;\n}\n\nbody {\n    margin: 0 auto;\n    overflow: hidden;\n    width: 100vw;\n    height: 100vh;\n    font-size: 1.2vh;\n}","",{version:3,sources:["webpack://./src/styles/style.css"],names:[],mappings:"AAAA;IACI,sBAAsB;AAC1B;;AAEA;IACI,cAAc;IACd,gBAAgB;IAChB,YAAY;IACZ,aAAa;IACb,gBAAgB;AACpB",sourcesContent:["* {\n    box-sizing: border-box;\n}\n\nbody {\n    margin: 0 auto;\n    overflow: hidden;\n    width: 100vw;\n    height: 100vh;\n    font-size: 1.2vh;\n}"],sourceRoot:""}]);const a=i},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var s="",o=void 0!==t[5];return t[4]&&(s+="@supports (".concat(t[4],") {")),t[2]&&(s+="@media ".concat(t[2]," {")),o&&(s+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),s+=e(t),o&&(s+="}"),t[2]&&(s+="}"),t[4]&&(s+="}"),s})).join("")},t.i=function(e,s,o,n,r){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(o)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(i[l]=!0)}for(var c=0;c<e.length;c++){var h=[].concat(e[c]);o&&i[h[0]]||(void 0!==r&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=r),s&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=s):h[2]=s),n&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=n):h[4]="".concat(n)),t.push(h))}},t}},537:e=>{e.exports=function(e){var t=e[1],s=e[3];if(!s)return t;if("function"==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),r="/*# ".concat(n," */"),i=s.sources.map((function(e){return"/*# sourceURL=".concat(s.sourceRoot||"").concat(e," */")}));return[t].concat(i).concat([r]).join("\n")}return[t].join("\n")}},379:e=>{var t=[];function s(e){for(var s=-1,o=0;o<t.length;o++)if(t[o].identifier===e){s=o;break}return s}function o(e,o){for(var r={},i=[],a=0;a<e.length;a++){var l=e[a],c=o.base?l[0]+o.base:l[0],h=r[c]||0,d="".concat(c," ").concat(h);r[c]=h+1;var p=s(d),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(u);else{var m=n(u,o);o.byIndex=a,t.splice(a,0,{identifier:d,updater:m,references:1})}i.push(d)}return i}function n(e,t){var s=t.domAPI(t);return s.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;s.update(e=t)}else s.remove()}}e.exports=function(e,n){var r=o(e=e||[],n=n||{});return function(e){e=e||[];for(var i=0;i<r.length;i++){var a=s(r[i]);t[a].references--}for(var l=o(e,n),c=0;c<r.length;c++){var h=s(r[c]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}r=l}}},569:e=>{var t={};e.exports=function(e,s){var o=function(e){if(void 0===t[e]){var s=document.querySelector(e);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}t[e]=s}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(s)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,s)=>{e.exports=function(e){var t=s.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(s){!function(e,t,s){var o="";s.supports&&(o+="@supports (".concat(s.supports,") {")),s.media&&(o+="@media ".concat(s.media," {"));var n=void 0!==s.layer;n&&(o+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),o+=s.css,n&&(o+="}"),s.media&&(o+="}"),s.supports&&(o+="}");var r=s.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,s)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},843:(e,t,s)=>{var o=s(379),n=s.n(o),r=s(795),i=s.n(r),a=s(569),l=s.n(a),c=s(565),h=s.n(c),d=s(216),p=s.n(d),u=s(589),m=s.n(u),f=s(890),y={};y.styleTagTransform=m(),y.setAttributes=h(),y.insert=l().bind(null,"head"),y.domAPI=i(),y.insertStyleElement=p(),n()(f.Z,y),f.Z&&f.Z.locals&&f.Z.locals;class v{constructor(e){this.entity=e}perform(){console.error("Not Implemented")}isPlayer(){return this.entity===b.player}}class g extends v{constructor(e){super(e)}perform(){return this}}class w extends v{constructor(e,t){super(e),this.reason=t}perform(){return this}}const x=new class{constructor(){this.eventHandler=null,this.player=null,this.gameMap=null,this.needsRenderUpdate=!1}handleEvents(){this.processAction(this.eventHandler.handleInput())}processAction(e){if(e&&this.eventHandler.isPlayerTurn){const t=e.perform();return!(t instanceof g||(t instanceof w?(t.reason&&console.log(t.reason),1):(x.needsRenderUpdate=!0,x.player.fov.compute(x.player,5),x.player.fov.updateMap(),this.handleEnemyTurns(),0)))}}handleEnemyTurns(){}},b=x,A=new class{constructor(){this.setupGameHtml(),this.resizeCanvas(),window.addEventListener("resize",this)}setupGameHtml(){const e=document.createElement("div");e.classList.add("game"),this.canvas=document.createElement("canvas"),this.canvas.classList.add("view"),e.appendChild(this.canvas),document.body.appendChild(e),this.ctx=this.canvas.getContext("2d")}handleEvent(e){"resize"===e.type&&this.resizeCanvas()}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,b.needsRenderUpdate=!0}clearAll(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}},T="ArrowUp",C="ArrowDown",M="Left Shift",k="Right Shift",E="Numpad .",S="Numpad 0",N="Numpad 1",D="Numpad 2",H="Numpad 3",L="Numpad 4",I="Numpad 5",F="Numpad 6",R="Numpad 7",_="Numpad 8",q="Numpad 9",U="Numpad Delete",B="Numpad Insert",W="Numpad End",O="Numpad ArrowDown",P="Numpad PageDown",X="Numpad ArrowLeft",j="Numpad Clear",J="Numpad ArrowRight",z="Numpad Home",G="Numpad ArrowUp",K="Numpad PageUp",V=new class{constructor(){const e=this;e.defaultDelay=25,e.lastShiftUp=null,e.treatShiftNumpadEqual=!0,e.keysDown=[],e.keysDelayed=[],e.defaults=new Map,e.controls=new Map,e.defaults.set("up",[_,T]),e.defaults.set("down",[D,C]),e.defaults.set("nw",[R]),e.defaults.set("ne",[q]),e.defaults.set("sw",[N]),e.defaults.set("se",[H]),e.defaults.set("wait",[I]),e.load(),addEventListener("keydown",(function(t){"/"===t.key&&t.preventDefault(),e.treatShiftNumpadEqual&&t.getModifierState("NumLock")&&!t.shiftKey&&t.code.startsWith("Numpad")&&t.keyCode<90&&e.lastShiftUp&&(e.keysDown[e.lastShiftUp]=!0);const s=e.getKey(t.key,t.code);e.keysDown[s]=!0}),!1),addEventListener("keyup",(function(t){const s=e.getKey(t.key,t.code);s!==M&&s!==k||(e.lastShiftUp=s),delete e.keysDown[s],delete e.keysDelayed[s]}),!1)}getKey(e,t){if(t.startsWith("Arrow")||(t.endsWith("Left")?e="Left "+e:t.endsWith("Right")?e="Right "+e:t.startsWith("Numpad")&&(e="Numpad "+e)),this.treatShiftNumpadEqual)switch(e){case U:e=E;break;case B:e=S;break;case W:e=N;break;case O:e=D;break;case P:e=H;break;case X:e=L;break;case j:e=I;break;case J:e=F;break;case z:e=R;break;case G:e=_;break;case K:e=q}return e}load(){const e=localStorage.getItem("controls");e?this.controls=new Map(JSON.parse(e)):this.resetToDefault()}save(){localStorage.setItem("controls",JSON.stringify(Array.from(this.controls.entries())))}setControls(e){this.controls=new Map;for(const[t,s]of e.entries()){const e=[];for(const t of s)e.push(t);this.controls.set(t,e)}this.save()}resetToDefault(){this.setControls(this.defaults)}clone(){const e=new Map;for(const[t,s]of this.controls.entries()){const o=[];for(const e of s)o.push(e);e.set(t,o)}return e}isPressed(e){const t=this;let s=!1,o=t.controls.get(e);if(!o){const s=t.defaults.get(e);s?(t.controls.set(e,s),t.save(),o=s):console.error("Missing keybindings for: ",e,o)}return o.forEach((function(e){e in t.keysDown&&(s=!0)})),s}isDelayed(e){const t=this;let s=!1;return this.controls.get(e).forEach((function(e){e in t.keysDelayed&&(s=!0)})),s}deleteKey(e,t){const s=this;s.controls.get(e).forEach((function(e){delete s.keysDown[e],t&&(s.keysDelayed[e]=!0)})),t&&setTimeout((function(){s.controls.get(e).forEach((function(e){delete s.keysDelayed[e]}))}),t)}testPressed(e,t){t=t||this.defaultDelay;const s=this;let o=!1;return s.isPressed(e)&&!s.isDelayed(e)&&(s.deleteKey(e,t),o=!0),o}};class Y extends v{constructor(e,t=0,s=0){super(e),this.dq=t,this.dr=s}perform(){console.error("Not Implemented")}}class Z{static PI=Math.PI;static HEX_A=this.PI/3;static HEX_RADIUS=20;constructor(){}static drawHex(e,t,s){e.beginPath();for(let o=0;o<6;o++)e.lineTo(t+Z.HEX_RADIUS*Math.cos(Z.HEX_A*o),s+Z.HEX_RADIUS*Math.sin(Z.HEX_A*o));e.closePath()}static hexToArray(e,t){return{x:Math.floor(e+t/2),y:t}}}class Q extends Y{constructor(e,t,s){super(e,t,s)}perform(){const e=this.entity.getComponent("hex");if(e){const t=Z.hexToArray(e.q+this.dq,e.r+this.dr),s=b.gameMap.getBlockingActorAtArrayLocation(t.x,t.y);if(!s)return new w(this.entity,"There's nothing to attack there!");{let e,t,o;this.isPlayer()?(e="You",t=""):(e=this.entity.name,t="s"),o=s===b.player?"You":s.name;const n=e+" attack"+t+" "+o;console.log(n)}}return this}}class $ extends Y{constructor(e,t,s){super(e,t,s)}perform(){const e=this.entity.getComponent("hex");if(e){const t=Z.hexToArray(e.q+this.dq,e.r+this.dr);if(!b.gameMap.isInBounds(t.x,t.y))return new w(this.entity,"Location is outside of the map!");const s=b.gameMap.tiles[t.x][t.y];if(s.isWall())return new w(this.entity,"There's a "+s.name+" in the way!");if(b.gameMap.getBlockingActorAtArrayLocation(t.x,t.y))return new w(this.entity,"There's something in the way!");e.moveTo(t.x,t.y)}return this}}class ee extends Y{constructor(e,t,s){super(e,t,s)}perform(){const e=this.entity.getComponent("hex");if(e){const t=Z.hexToArray(e.q+this.dq,e.r+this.dr);return b.gameMap.getBlockingActorAtArrayLocation(t.x,t.y)?new Q(this.entity,this.dq,this.dr).perform():new $(this.entity,this.dq,this.dr).perform()}return this}}class te extends class{constructor(){this.mouseDown=!1,window.addEventListener("mousemove",this),window.addEventListener("mousedown",this),window.addEventListener("mouseup",this),window.addEventListener("click",this),window.addEventListener("contextmenu",this),window.addEventListener("change",this),window.addEventListener("keydown",this),this.isPlayerTurn=!0}teardown(){window.removeEventListener("mousemove",this),window.removeEventListener("mousedown",this),window.removeEventListener("mouseup",this),window.removeEventListener("click",this),window.removeEventListener("contextmenu",this),window.removeEventListener("change",this),window.removeEventListener("keydown",this)}handleEvent(e){switch(e.type){case"mousemove":this.onMouseMove(e);break;case"mousedown":this.onMouseDown(e);break;case"mouseup":this.onMouseUp(e);break;case"click":this.onLeftClick(e);break;case"contextmenu":this.onRightClick(e);break;case"change":this.onChange(e);break;case"keydown":this.onKeydown(e)}}handleInput(){}onMouseMove(){}onMouseDown(){this.mouseDown=!0}onMouseUp(){this.mouseDown=!1}onLeftClick(){}onRightClick(){}onChange(){}onKeydown(){}}{constructor(){super()}teardown(){super.teardown()}handleInput(){let e=null;return this.isPlayerTurn&&(V.testPressed("up")?e=new ee(b.player,-1,0):V.testPressed("down")?e=new ee(b.player,1,0):V.testPressed("nw")?e=new ee(b.player,0,-1):V.testPressed("ne")?e=new ee(b.player,-1,1):V.testPressed("sw")?e=new ee(b.player,1,-1):V.testPressed("se")&&(e=new ee(b.player,0,1))),e}}class se{constructor(e={},t,s){this.args=e,this.baseType=t||"component",this.type=s||this.baseType,this.parentEntity=e.parentEntity,this.cachedSave=null}clearSaveCache(){this.cachedSave=null,this.parentEntity?.clearSaveCache()}save(){return null}hasComponent(){return this.args.components&&void 0!==this.args.components[this.type]}saveBoolean(e,t){if(this.cachedSave)return this.cachedSave;const s={};return e!==t&&(s[this.type]=e),this.cachedSave=s,s}loadBooleanOrObject(e){const t=typeof this.args.components[this.type];return"boolean"===t?this.args.components[this.type]:"object"===t?this.args.components[this.type][e]:void 0}loadArg(e,t){return this.args.components[this.type][e]||t}}class oe extends se{constructor(e={}){super(e,"blocksFov"),this.blocksFov=!1,this.hasComponent()&&(this.blocksFov=this.loadBooleanOrObject("blocksFov"))}save(){return this.saveBoolean(this.blocksFov,!1)}}class ne extends se{constructor(e={}){super(e,"blocksMovement"),this.blocksMovement=!1,this.hasComponent()&&(this.blocksMovement=this.loadBooleanOrObject("blocksMovement"))}save(){return this.saveBoolean(this.blocksMovement,!1)}}class re extends se{constructor(e){super(e,"fov"),this.explored=!1,this.visible=!1,this.hasComponent()&&(this.explored=this.loadArg("explored",!1),this.visible=this.loadArg("visible",!1))}save(){if(this.cachedSave)return this.cachedSave;const e={fov:{}};return!1!==this.explored&&(e.fov.explored=this.explored),!1!==this.visible&&(e.fov.visible=this.visible),this.cachedSave=e,e}setExplored(e){this.explored=e,this.clearSaveCache()}setVisible(e){this.visible=e}}class ie extends se{constructor(e={}){super(e,"hex"),this.row=0,this.col=0,this.q=0,this.r=0,this.s=0,this.hasComponent()&&(this.row=this.loadArg("row",0),this.col=this.loadArg("col",0)),this.updateHexCoords()}save(){if(this.cachedSave)return this.cachedSave;const e={hex:{}};return 0!==this.row&&(e.hex.row=this.row),0!==this.col&&(e.hex.col=this.col),this.cachedSave=e,e}moveTo(e,t){this.row=e,this.col=t,this.updateHexCoords()}updateHexCoords(){this.q=this.row-Math.floor(this.col/2),this.r=this.col,this.s=-this.q-this.r}isEdge(e){return 0===this.row||0===this.col||this.row===e.rows-1||this.col===e.cols-1}getDisplayX(){return this.q+this.r/2}getDisplayY(){return this.r}getTileFromArray(e,t,s){const o=Z.hexToArray(t,s);return e[o.x]&&e[o.x][o.y]?e[o.x][o.y]:null}getNumAdjacentWalls(e){const t=this.getTileFromArray(e,this.q,this.r-1),s=this.getTileFromArray(e,this.q+1,this.r-1),o=this.getTileFromArray(e,this.q+1,this.r),n=this.getTileFromArray(e,this.q,this.r+1),r=this.getTileFromArray(e,this.q-1,this.r+1),i=this.getTileFromArray(e,this.q-1,this.r);return this.isTileWall(t)+this.isTileWall(s)+this.isTileWall(o)+this.isTileWall(n)+this.isTileWall(r)+this.isTileWall(i)}isTileWall(e){return null===e||e.isWall()?1:0}isInRange(e,t){return Math.abs(this.q-e.q)<t&&Math.abs(this.r-e.r)<t&&Math.abs(this.s-e.s)<t}}const ae=new class{constructor(){this.types=new Map,this.init()}init(){this.load(new oe),this.load(new ne),this.load(new re),this.load(new ie)}load(e){this.types.set(e.type,e)}create(e,t,s){return new(0,this.types.get(t).constructor)(s)}};class le{constructor(){}static extend(e){e=e||{};for(let t=1;t<arguments.length;t++)if(arguments[t])for(const s in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],s)&&(e[s]=arguments[t][s]);return e}static deep(e){e=e||{};for(let t=1;t<arguments.length;t++){const s=arguments[t];if(s)for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&("object"==typeof s[t]?s[t]instanceof Array?e[t]=s[t].slice(0):e[t]=le.deep(e[t],s[t]):"boolean"==typeof e&&void 0===e[t]?e=s[t]:e[t]=s[t])}return e}}class ce{constructor(e){this.type=e.type||"entity",this.id=e.id,this.name=e.name||"",this.description=e.description||"",this.sprite=e.sprite||"",this.color=e.color||"#fff",this.componentArray=[],this.components={},e.components&&(this.loadComponents(e,e.components),this.callEvent("onComponentsLoaded")),this.cachedSave=null}clone(){console.error("Not implemented")}callEvent(e,t){for(const s of this.componentArray)s[e]?.(t);this[e]?.(t)}draw(){}loadComponents(e,t){const s=this;Object.keys(t).forEach((function(t){const o=ae.types.get(t);if(o){const n=o.baseType;s.getComponent(n)||s.setComponent(ae.create(this,t,e),!1)}}))}setComponent(e){e.parentEntity=this,this.components[e.baseType]=e,this.componentArray.push(e)}getComponent(e){return this.components[e]}removeComponent(e){if(this.components[e]){this.components[e]=void 0;for(const t of this.componentArray)if(t.baseType===e){const e=this.componentArray.indexOf(t);this.componentArray.splice(e,1);break}}}clearSaveCache(){this.cachedSave=null}save(){if(null!==this.cachedSave)return this.cachedSave;const e={id:this.id,type:this.type,name:this.name,description:this.description,sprite:this.sprite,color:this.color,components:{}};for(const t of this.componentArray){const s=t.save();null!==s&&s!=={}&&le.deep(e.components,s)}return this.cachedSave=e,e}}class he extends class{constructor(){this.previousVisibleTiles=[],this.visibleTiles=[]}compute(e,t){this.previousVisibleTiles=this.visibleTiles,this.visibleTiles=[],this.hex=e.getComponent("hex"),this.q=this.hex.q,this.r=this.hex.r,this.tile=b.gameMap.getTileFromHexCoords(this.q,this.r);const s=this.hex.row,o=this.hex.col;this.left=Math.max(0,s-t),this.right=Math.min(b.gameMap.rows,s+t),this.top=Math.max(0,o-t),this.bottom=Math.min(b.gameMap.cols,o+t)}exploreTileByHex(e,t){const s=Z.hexToArray(e,t);this.visibleTiles.push(b.gameMap.tiles[s.x][s.y])}exploreTileByArray(e,t){this.visibleTiles.push(b.gameMap.tiles[e][t])}updateMap(){for(const e of this.previousVisibleTiles){const t=e.getComponent("fov");t&&t.setVisible(!1)}for(const e of this.visibleTiles){const t=e.getComponent("fov");t?(t.setExplored(!0),t.setVisible(!0)):e.setComponent(new re({components:{fov:{explored:!0,visible:!0}}}))}}}{constructor(){super()}compute(e,t){super.compute(e,t),this.exploreTileByHex(this.q,this.r);for(let e=1;e<=6;e++)this.exploreDirection(this.q,this.r,e,t)}exploreDirection(e,t,s,o){let n=s+1;n>6&&(n=1);let r,i,a=!1,l=!1;const c=b.gameMap.getTileNeighbor(e,t,s);c&&(r=c.getComponent("hex"),this.exploreTileByArray(r.row,r.col),c.isWall()||(a=!0));const h=b.gameMap.getTileNeighbor(e,t,n);if(h&&(i=h.getComponent("hex"),this.exploreTileByArray(i.row,i.col),h.isWall()||(l=!0)),--o>1){if(a||l){let e;if(r?e=b.gameMap.getTileNeighbor(r.q,r.r,n):i&&(e=b.gameMap.getTileNeighbor(i.q,i.r,s)),e){const t=e.getComponent("hex");this.exploreTileByArray(t.row,t.col)}}a&&this.exploreDirection(r.q,r.r,s,o),l&&this.exploreDirection(i.q,i.r,s,o)}}}class de extends ce{constructor(e={}){e.type="actor",super(e),this.fov=new he}clone(){return new de(this.save())}draw(){const e=this.getComponent("hex"),t=Z.HEX_RADIUS+Z.HEX_RADIUS*(1+Math.cos(Z.HEX_A))*e.getDisplayY(),s=1.15*Z.HEX_RADIUS+2*Z.HEX_RADIUS*Math.sin(Z.HEX_A)*e.getDisplayX();super.draw(t,s),Z.drawHex(A.ctx,t,s),this.color&&(A.ctx.fillStyle=this.color,A.ctx.fill()),A.ctx.stroke(),A.ctx.fillStyle="white",A.ctx.textAlign="center",A.ctx.textBaseline="middle",A.ctx.font="26px serif",A.ctx.fillText("@",t,s)}}class pe extends ce{constructor(e={}){e.type="tile",super(e)}clone(){return new pe(this.save())}isWall(){return this.getComponent("blocksMovement")&&this.getComponent("blocksMovement").blocksMovement}draw(e,t){const s=this.getComponent("fov");s&&s.explored&&(Z.drawHex(A.ctx,e,t),this.color&&(A.ctx.fillStyle=this.color,A.ctx.fill()),A.ctx.stroke(),s.visible||(Z.drawHex(A.ctx,e,t),A.ctx.fillStyle="rgba(0, 0, 0, .25)",A.ctx.fill(),A.ctx.color="rgba(0, 0, 0, .25)",A.ctx.stroke()))}}const ue=JSON.parse('[{"id":"base_actor","type":"actor","components":{"blocksMovement":true,"hex":{"row":0,"col":0}}}]'),me=JSON.parse('[{"id":"orc","extends":"base_actor","name":"Orc","color":"#3f7f3f","components":{}},{"id":"troll","extends":"base_actor","name":"Troll","color":"#007f00","components":{}}]'),fe=JSON.parse('[{"id":"player","extends":"base_actor","name":"Player","color":"#00f","components":{}}]'),ye=JSON.parse('[{"id":"base_tile","type":"tile","components":{}}]'),ve=JSON.parse('[{"id":"base_floor","extends":"base_tile","components":{}},{"id":"cave_floor","extends":"base_floor","color":"#ddd"}]'),ge=JSON.parse('[{"id":"base_wall","extends":"base_tile","components":{"blocksMovement":true,"blocksFov":true}},{"id":"cave_wall","extends":"base_wall","color":"#666"}]'),we=new class{constructor(){this.types=new Map,this.templates=new Map,this.init()}init(){this.load(new de),this.load(new pe),this.loadTemplates()}load(e){this.types.set(e.type,e)}create(e,t={}){let s;if(s="object"==typeof e?e:JSON.parse(e),void 0!==s.extends){if(this.templates.has(s.extends)){const e=JSON.parse(this.templates.get(s.extends));return delete s.extends,this.create(le.deep(e,s),t)}console.error("Json template for id '"+s.extends+"' is missing. Cannot extend from it.")}return new(this.types.get(s.type).constructor)(le.deep(s,t))}createFromTemplate(e,t={}){return this.templates.has(e)?this.create(this.templates.get(e),t):(console.error("Json template for id '"+e+"' is missing."),null)}loadTemplate(e){for(const t of e){const e=t.id;this.templates.has(e)?console.error("Template for entity id '"+e+"' already exists."):this.templates.set(e,JSON.stringify(t))}}loadTemplates(){this.loadTemplate(ue),this.loadTemplate(me),this.loadTemplate(fe),this.loadTemplate(ye),this.loadTemplate(ve),this.loadTemplate(ge)}},xe=JSON.parse('[{"id":"cave","levels":[{"level":1,"actors":[{"id":"orc","weight":80},{"id":"troll","weight":20}]}]}]'),be=new class{constructor(){this.entityGroups=new Map,this.generators=new Map,this.loadGenerator(xe)}loadGenerator(e){for(const t of e)this.generators.set(t.id,t.levels)}getChancesForLevel(e,t){let s;const o=this.generators.get(e);for(const e of o){if(e.level>t)break;s=e}return s}getActorForLevel(e,t){const s=this.getChancesForLevel(e,t).actors;let o=this.getRandomFromGroup(s);for(;void 0!==o.group;){const e=this.entityGroups.get(o.group);o=this.getRandomFromGroup(e)}return o.id}getRandomFromGroup(e){let t,s=0;for(const t of e)s+=t.weight;let o=0;const n=Math.random()*s;for(const s of e)if(o+=s.weight,n<o){t=s;break}return t}};class Ae extends class{constructor(e,t){this.rows=e,this.cols=t,this.init()}init(){this.tiles=class{constructor(){}static create2dArray(e){const t=[];for(let s=0;s<e;s++)t[s]=[];return t}}.create2dArray(this.rows),this.actors=[]}isInBounds(e,t){return 0<=e&&e<this.rows&&0<=t&&t<this.cols}create(){}draw(){for(let e=0;e<this.rows;e++){let t=2*Z.HEX_RADIUS+2*Z.HEX_RADIUS*Math.sin(Z.HEX_A)*e;for(let s=0;s<this.cols;s++){const o=Z.HEX_RADIUS+Z.HEX_RADIUS*(1+Math.cos(Z.HEX_A))*s;t-=(-1)**s*Z.HEX_RADIUS*Math.sin(Z.HEX_A);const n=this.tiles[e][s],r=n.getComponent("fov");r&&r.explored&&n.draw(o,t)}}for(const e of this.actors){const t=e.getComponent("hex"),s=b.gameMap.getTileFromArrayCoords(t.row,t.col).getComponent("fov");s&&s.visible&&e.draw()}}getTileFromArrayCoords(e,t){return this.tiles[e]?this.tiles[e][t]:null}getTileFromHexCoords(e,t){const s=Z.hexToArray(e,t);return this.tiles[s.x][s.y]}getTileNeighbor(e,t,s){switch(s){case 1:return this.getTileFromHexCoords(e-1,t);case 2:return this.getTileFromHexCoords(e-1,t+1);case 3:return this.getTileFromHexCoords(e,t+1);case 4:return this.getTileFromHexCoords(e+1,t);case 5:return this.getTileFromHexCoords(e+1,t-1);default:return this.getTileFromHexCoords(e,t-1)}}getBlockingActorAtArrayLocation(e,t){let s=null;for(const o of this.actors){const n=o.getComponent("hex");if(n&&e===n.row&&t===n.col){const e=o.getComponent("blocksMovement");if(e&&e.blocksMovement){s=o;break}}}return s}}{constructor(e,t){super(e,t),this.percentAreWalls=.35,this.wallEntity=we.createFromTemplate("cave_wall",{components:{hex:{row:0,col:0}}}),this.floorEntity=we.createFromTemplate("cave_floor",{components:{hex:{row:0,col:0}}}),this.create()}create(){this.randomFillBuild(),this.makeCaverns(15,0)}randomFillBuild(){const e=Math.floor(Math.random()*this.rows),t=Math.floor(Math.random()*this.cols);for(let s=0;s<this.rows;s++)for(let o=0;o<this.cols;o++){let n;n=0===s||0===o||s===this.rows-1||o===this.cols-1?this.wallEntity.clone():s===e||o===t?this.floorEntity.clone():Math.random()<this.percentAreWalls?this.wallEntity.clone():this.floorEntity.clone(),n.getComponent("hex").moveTo(s,o),this.tiles[s][o]=n}}addRandomNoise(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.cols;t++)if(Math.random()<.02){const s=this.wallEntity.clone();s.getComponent("hex").moveTo(e,t),this.tiles[e][t]=s}}makeCaverns(e,t){this.addRandomNoise();for(let e=0;e<this.rows;e++)for(let t=0;t<this.cols;t++){let s;this.placeWallLogic(this.tiles[e][t]),s=this.placeWallLogic(this.tiles[e][t])?this.wallEntity.clone():this.floorEntity.clone(),s.getComponent("hex").moveTo(e,t),this.tiles[e][t]=s}e--;const s=this;e>0?t>0?(setTimeout((()=>{s.makeCaverns(e,t)}),t),b.needsRenderUpdate=!0):s.makeCaverns(e):b.needsRenderUpdate=!0}placeWallLogic(e){const t=e.getComponent("hex"),s=t.getNumAdjacentWalls(this.tiles);if(t.isEdge(this))return!0;if(e.isWall()){if(s>=2)return!0}else if(s>=4)return!0;return!1}placeEntities(e,t,s,o){const n=b.player.getComponent("hex");for(let r=0;r<this.rows;r++)for(let i=0;i<this.cols;i++){const a=this.tiles[r][i];if(!a.isWall()){const r=a.getComponent("hex");if(!n.isInRange(r,o)&&Math.random()<s){const s=be.getActorForLevel(e,t),o=we.createFromTemplate(s,{components:{hex:{row:r.row,col:r.col}}});this.actors.push(o)}}}}}!function(){function e(){b.handleEvents(),b.needsRenderUpdate&&(A.clearAll(),b.gameMap.draw(),b.needsRenderUpdate=!1),window.requestAnimationFrame(e)}!function(){b.gameMap=new Ae(35,80),b.player=we.createFromTemplate("player",{components:{hex:{row:0,col:0}}});const t=b.player.getComponent("hex");let s=!1;for(;!s;){const e=Math.floor(Math.random()*(b.gameMap.rows-8))+4,o=Math.floor(Math.random()*(b.gameMap.cols-4))+2;b.gameMap.tiles[e][o].isWall()||(t.moveTo(e,o),s=!0)}b.gameMap.actors.push(b.player),b.gameMap.placeEntities("cave",1,.03,5),b.eventHandler=new te,b.needsRenderUpdate=!0,b.player.fov.compute(b.player,5),b.player.fov.updateMap(),window.requestAnimationFrame(e)}()}()}},e=>{e(e.s=843)}]);
//# sourceMappingURL=app.6bfa785b475e6e283b90.js.map